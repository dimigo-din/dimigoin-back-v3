
name: Automatic Deploy Production

on:
  push:
    branches: [ master ]
      
jobs:
   build:
     runs-on: self-hosted

     steps:
     - uses: actions/checkout@v2

     - name: remove old packageğŸ—‘ 
       run: forever stopall

     - name: remove old package file 
       run: sudo rm -rf ~/dimigoin-back-v3

     - name: install package âœ”ï¸
       run: yarn

     - name: genarate target folder ğŸ—‚
       run: mkdir ~/dimigoin-back-v3

     - name: build typescript ğŸ“¦
       run: tsc

     - name: move pacakage ğŸ’
       run: mv * ~/dimigoin-back-v3

     - name: deploy packageğŸš€ 
       run: forever start /home/edison/dimigoin-back-v3/dist/index.js
       
     - name: Slack Notification failed ğŸ™…
       if: failure()
       uses: rtCamp/action-slack-notify@v2.0.0
       env:
          SLACK_CHANNEL: build-notification
          SLACK_COLOR: '#FF0000'
          SLACK_ICON: http://github.com/dimigoin.png?size=48
          SLACK_MESSAGE: 'ë°±ì—”ë“œì— ëŒ€í•œ ë°°í¬ê°€ ì‹¤íŒ¨í–ˆì–´ìš” ! :cry:'
          SLACK_TITLE: Deploy failed
          SLACK_USERNAME: Dimigoin auto deploy bot
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}

     - name: Slack Notification success ğŸ™†
       if: success()
       uses: rtCamp/action-slack-notify@v2.0.0
       env:
          SLACK_CHANNEL: build-notification
          SLACK_COLOR: '#04ff00'
          SLACK_ICON: http://github.com/dimigoin.png?size=48
          SLACK_MESSAGE: 'ë°±ì—”ë“œì— ëŒ€í•œ ë°°í¬ê°€ ì™„ë£Œë˜ì—ˆì–´ìš” ! :rocket:'
          SLACK_TITLE: Deploy Success
          SLACK_USERNAME: Dimigoin auto deploy bot
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
